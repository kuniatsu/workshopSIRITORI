<html>
    <body style="text-align: center;">
        <p id='mess1'>「<span id="key">り</span>」から始まる言葉をひらがなで入力してください。</p>
        <p id='mess2'>「<span id="key">り</span>」から始まる言葉をひらがなで入力してください。</p>
        <input id='tb' type="text" value='りょうり'>
        <button id='bt'>送信</button>
        <script>
            var initial;   
            var end;    
            var wordList = [];     
            var key = document.getElementById("key");
            var mess1 = document.getElementById("mess1");
            var mess2 = document.getElementById("mess2");
            var tb = document.getElementById("tb");
            var bt = document.getElementById("bt");
        
            bt.addEventListener('click',()=>{        
                //入力文字列の頭文字を取得
                initial = tb.value.slice(0,1);
                console.dir(initial);

                //入力文字列の頭文字が正しいか確認
                if(initial == key){
                    console.dir("正しい");
                }else{
                    console.dir("正しくない");
                }

                //すでに出ている言葉ではないか確認


                //入力文字列の語尾を取得
                end = tb.value.slice(-1);
                console.dir(end);

                //入力文字列の語尾が正しいか確認
                if(end == "ん"){
                    console.dir("正しい");
                }else{
                    console.dir("正しくない");
                }

                //最後の文字を取得
                var endChar = getEndChar(word);


                //次の出題をする


                //入力文字のチェック
                var flg = checkKey(word,startText,endChar);
                if(flg){

                    //言葉を記憶
                    saveWord(word);

                    //頭文字からの検索
                    var out_key = loadWord(word,endChar);

                    //結果
                    jatch(out_key,endChar);

                    //テキストボックス初期化
                    t.innerText = "";
                    console.dir(t);
                }
            });

            function checkKey(word,startChar,endChar){
                //最初の文字を取得
                var ini = word.slice(0,1);
                console.log(ini);

                //単語があっている確認
                if(ini != startChar){
                    //処理中止
                    console.log("処理中止");
                    return false;
                }
                
                //最後が「ん」じゃないことを確認
                if(endChar == "ん"){
                    //処理中止
                    console.log("処理中止");
                    out.innerText = "「ん」が最後なので、あなたの負けです。";  
                    a.addEventListener('click',null);
                    return false;
                }
                return true;
            }

            function getEndChar(word){
                var en = word.slice(-1);
                return en;
            }

            function jatch(key,endChar){
                if(key == ""){
                    out.innerText = "答えられませんでした。「"+endChar+"」から始まる言葉をひらがなで入力してください。";                  
                    a.addEventListener('click',()=>{
                        word = t.value;
                        var save = localStorage.getItem('game');
                        localStorage.setItem('game',save+","+word); 
                        out.innerText = "ありがとうございました。ゲームを続ける場合は更新してください。";  
                    });
                }else{
                    out.innerText = key;

                    //設定もじを更新
                    startText = key.slice(-1);
                    console.log("次のお題:"+startText);
                }
            }

        </script>
    </body>
</html>
